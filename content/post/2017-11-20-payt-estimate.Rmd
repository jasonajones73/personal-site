---
title: 'Estimating Pay-As-You-Throw (PAYT) Cost Recovery Rate'
author: "Jason Jones"
date: 2017-11-20T21:09:00-00:00
categories: ["R"]
tags: ["R Markdown", "garbage", "budget", "analysis"]
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(ggthemes)

division.expense <- read_csv("data/SWS Exercise Data.csv")
```

```{r include=FALSE}
library(knitr)
opts_chunk$set(tidy.opts=list(width.cutoff=60),tidy=TRUE)
```

## Introduction
As a different approach to this exercise, I would like to avoid traditional Microsoft Excel analysis and deliver my product in a fully reproducible [R Markdown](http://rmarkdown.rstudio.com/) format. I will attempt to walk you through my thought process in a simple fashion, including all code chunks and formulas. If this analysis is consistent with a best practice approach, it can be made available to others for reproduction. The transparency and reproducibility of R Markdown allows for others to easily understand, critique and augment the analysis.

The research question posed is:

> *Using the information given and the accompanying Excel file, determine how much the city would have to charge per bag to cover **garbage** collection and disposal costs.*

To answer this question I will evaluate The City of Raleigh's current state against the desired state.

* **Current State:** customers pay a monthly fee for garbage and recycling collection regardless of how much total waste they produce
* **Desired State:** customers purchase special garbage bags from the city and only pay for the waste that they produce

I have broken this evaluation down into four steps to hopefully provide additional clarity.

1. Forecast Collection Breakdown
2. Estimate Net Costs
3. Calculate Recovery Estimate
4. Determine PAYT Rate Estimate

Breaking down the analysis in this manner not only provides additional clarity but allows co-workers and supervisors to find any errors more quickly than searching through formulas in a spreadsheet. Fortunately, that will allow you to more easily locate the inevitable errors contained within this analysis.

## Step 1: Forecast Collection Breakdown

### 1.1 Calculate New Diversion Rate

```{r}
total.garbage.tons = 84582
total.recycling.tons = 25189

current.diversion.rate = total.recycling.tons/(total.garbage.tons + total.recycling.tons)

new.diversion.rate = round(current.diversion.rate * 1.30, digits = 2)
```
Here, I have to start with the current diversion rate and add the projected increase. To calculate the current diversion rate, I am dividing the total recycling tons by the total tons collected between garbage and recycling. Finally, I add the 30% projected increase. With the above calculation, I estimate a new diversion rate of **`r (new.diversion.rate * 100)`**%.

### 1.2 Calculate New Garbage/Recycling Split

```{r}
total.tons = total.garbage.tons + total.recycling.tons

new.total.recycling.tons = round(total.tons * new.diversion.rate)
new.total.garbage.tons = round(total.tons - new.total.recycling.tons)
```
I can now use my new diversion rate estimate to calculate an updated split between garbage and recycling. To do this, I multiply the old total by the diversion rate to arrive at a total for recycling. From there, I can subtract recycling from the total to arrive a projection for tons of garbage. I estimate that the new total tons of garbage will be **`r prettyNum(new.total.garbage.tons, big.mark = ",")`** and the new total tons of recycling will be **`r prettyNum(new.total.recycling.tons, big.mark = ",")`**.

## Step 2: Estimate Net Costs

### 2.1 Calculate Total Cost to Department

```{r}
tipping.fees = 3686202
garbage.cost.per.ton = 273
recycling.cost.per.ton = 37
recycling.profit.per.ton = 30
recycling.fee = 2.60
households.served = 120500

recycling.fee.revenue = (recycling.fee * households.served) * 12

recycling.profit = recycling.profit.per.ton * new.total.recycling.tons

garbage.collection.expense = garbage.cost.per.ton * new.total.garbage.tons + tipping.fees

recycling.collection.expense = (recycling.cost.per.ton * new.total.recycling.tons) - (recycling.profit + recycling.fee.revenue)

total.cost = garbage.collection.expense + recycling.collection.expense

```
The above calculation renders two very important figures. I estimate a new garbage collection and disposal expense of **$`r prettyNum(garbage.collection.expense, big.mark = ",")`**. Combined with the new net recycling collection expense, this results in a total collection and disposal net cost estimate of **$`r prettyNum(total.cost, big.mark = ",")`**.

## Step 3: Calculate Recovery Estimate

### 3.1 Calculate Current Fee Revenue

```{r}
garbage.fee = 12.20

total.current.fee.revenue = ((garbage.fee + recycling.fee) * households.served) * 12
```
Using the information provided in the word document, I use the above formula to calculate total current fee revenue. The above formula yields a total current fee revenue of **$`r prettyNum(total.current.fee.revenue, big.mark = ",")`**

### 3.2 Calculate Average Total Expense

```{r}
average.total.expense <- division.expense %>% 
  group_by(`Fiscal Year`) %>% 
  summarise(total = sum(Expense)) %>% 
  ungroup() %>% 
  summarise(average = mean(total))

average.total.expense = round(average.total.expense$average)
```
Here, I use the data from the spreadsheet that I have pulled in to calculate an average total division expense. To do this I group the data by fiscal year, calculate a sum for each fiscal year and then calculate an average. My average total expense estimate comes out to **$`r prettyNum(average.total.expense, big.mark = ",")`**

### 3.3 Calculate Current Recovery Rate

```{r tidy=FALSE}
old.recycling.profit = recycling.profit.per.ton * total.recycling.tons

current.recovery.rate = +
  (total.current.fee.revenue + old.recycling.profit) / average.total.expense 
```
Now I am able to use my prior two calculations to estimate the current recovery rate. You may also notice an additional step above to create an estimate of current recycling profit before any changes occur. To calculate the recovery rate, I divide the total current fee revenue and the recycling revenue that I just calculated by the average total expense that I calculated in the last step. This formula yields a current recovery rate of **`r round(current.recovery.rate * 100, digits = 2)`%**.

### 3.4 Project New Total Expense

```{r}
admin.yardwaste.average.total = division.expense %>%
  filter(Division!="Recycling") %>%
  filter(Division!="Residential Collection") %>%
  group_by(`Fiscal Year`) %>%
  summarise(total = sum(Expense)) %>%
  ungroup() %>%
  summarise(average = mean(total))

new.total.expense.projection = round(admin.yardwaste.average.total$average) + garbage.collection.expense + recycling.collection.expense
```
To project the new total expense, I am pulling data from several prior steps. First, I use the spreadsheet data that I pulled in to isolate costs associated with division administration and yardwaste collection. I perform the same function on this data, once isolated, as I did in 3.2. Once this is calculated I add this estimate to my newly calculated garbage and recycling expense for a new total expense projection of **$`r prettyNum(new.total.expense.projection, big.mark = ",")`**.

### 3.5 Calculate Total Expense To Recover

```{r}
new.expense.to.recover = round(new.total.expense.projection * current.recovery.rate)
```
Finally, I am able to use the new total expense estimate and recovery rate to come up with an updated estimate of total expenses to recover. The above formula yields an estimate of **$`r prettyNum(new.expense.to.recover, big.mark = ",")`**.

## Step 4: Determine PAYT Rate Estimate

### 4.1 Calculate Bags Per Year

```{r}
bag.capacity.pounds = 20

total.pounds = new.total.garbage.tons * 2000

bags.per.year = total.pounds/bag.capacity.pounds
```
The first step in determining the PAYT rate estimate is calculating how many garbage bags we expect to sell for the year. To do this, I need to convert my new tons of garbage estimate from 1.2 to pounds of garbage by multiplying it by 2,000 (pounds per ton). After that is done, I can estimate how many garbage bags we will sell by dividing the total garbage pounds by the estimated bag capacity. This yields an estimate of **`r prettyNum(bags.per.year, big.mark = ",")` bags**.

### 4.2 Calculate Cost Per Bag (w/o Recovery)

```{r}
cost.per.bag = round(garbage.collection.expense/bags.per.year, digits = 2)
```
Finally, I am able to deliver my first estimate for cost per bag. This estimate assumes that we only want to "cover **garbage** collection and disposal costs" as stated in the exercise prompt. I divide my updated estimate of total garbage collection and disposal expense by my estimate of bags for the year to come up with a per bag estimate of **$`r cost.per.bag`**.

You will see below, that this option achieves the target recovery rate of 80% outlined in the budget document.

### 4.3 Calculate Cost Per Bag (w/ Recovery Consideration)

```{r}
recovery.cost.per.bag = round(new.expense.to.recover/bags.per.year, digits = 2)

target.recovery.rate = .80

target.expense.to.recover = round(new.total.expense.projection * target.recovery.rate)

target.recovery.cost.per.bag = round(target.expense.to.recover/bags.per.year, digits = 2)
```
For a possibly more realistic projection, I am incorporating my updated estimate of total expenses to recover. Since this was noted in the budget document, I am assuming that this will be the primary calculation considered. I am also providing a per bag estimate for the 80% cost recovery target mentioned in the budget document.

My per bag estimate, with a current cost recovery estimate of **`r round(current.recovery.rate * 100, digits = 2)`%**, comes out to **$`r recovery.cost.per.bag` per bag**.

My per bag estimate, with a target cost recovery estimate of **80%**, comes out to **$`r target.recovery.cost.per.bag` per bag**.

*Please note that in both estimates I am subtracting my estimated recycling fee revenue and recycling profit.*

## Additional Consideration

### Subsidizing Yardwaste Collection
Another consideration that may be applicable is the obvious subsidy to yardwaste collection. Administrative costs are a given, but yardwaste appears to be the only direct service provided with no costs recovered. Below, I will take a quick look at the difference in pricing if a fee to cover the cost of yardwaste collection is also considered.

### Isolate Average Yardwaste Collection Expense

```{r}
isolate.yardwaste.cost = division.expense %>%
  filter(Division=="Yardwaste Center") %>%
  group_by(`Fiscal Year`) %>%
  summarise(total = sum(Expense)) %>%
  ungroup() %>%
  summarise(average = mean(total))

isolate.yardwaste.cost = isolate.yardwaste.cost$average
```

### Calculate Cost Per Bag Without Yardwaste Subsidy

```{r}
recovery.cost.per.bag.no.yw = round((new.expense.to.recover - isolate.yardwaste.cost)/bags.per.year, digits = 2)

target.expense.to.recover.no.yw = round((new.total.expense.projection - isolate.yardwaste.cost) * target.recovery.rate)

target.recovery.cost.per.bag.no.yw = round(target.expense.to.recover.no.yw/bags.per.year, digits = 2)
```
With no yardwaste collection fees included, my per bag estimate, with a current cost recovery estimate of **`r round(current.recovery.rate * 100, digits = 2)`%**, comes out to **$`r recovery.cost.per.bag.no.yw` per bag**.

Additionally, my per bag estimate, with a target cost recovery estimate of **80%**, comes out to **$`r target.recovery.cost.per.bag.no.yw` per bag**.

## Visualize Collection Differential

```{r}
df = data.frame(Type = c("Garbage", "Recycling"), Current = c(total.garbage.tons, total.recycling.tons), PAYT = c(new.total.garbage.tons, new.total.recycling.tons))

df = df %>% gather("Estimates", "Tons", 2:3)

df %>% ggplot(aes(Type, Tons, fill = Type)) + geom_col(position = "dodge") + facet_wrap(~Estimates) + ggtitle("Tonnage Comparison: Current vs PAYT") + theme_minimal() + scale_y_continuous(labels = scales::comma)
```

## Supplement: Attached Data
```{r echo=FALSE}
kable(division.expense)
```


